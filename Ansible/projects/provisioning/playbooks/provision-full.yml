---
# playbooks/provision-full.yml - Complete infrastructure provisioning
# Run: ansible-playbook playbooks/provision-full.yml -i inventories/test/hosts.ini -v

- name: WALLIX Bastion - Full Provisioning
  hosts: bastions
  gather_facts: no

  tasks:
    - name: Step 1 - Authenticate
      include_role:
        name: wallix.bastion.auth
      vars:
        wallix_bastion_api_version: "api"
      tags: [auth]

    - name: Step 2 - Create Global Domains
      include_role:
        name: wallix.bastion.global_domains
      when: wallix_global_domains is defined
      tags: [domains]

    - name: Step 3 - Create Global Accounts
      include_role:
        name: wallix.bastion.global_accounts
      when: wallix_global_accounts is defined
      tags: [accounts]

    - name: Step 4 - Create Devices
      include_role:
        name: wallix.bastion.devices
      when: wallix_devices is defined
      tags: [devices]

    - name: Step 5 - Create Users
      include_role:
        name: wallix.bastion.users
      when: wallix_users is defined
      tags: [users]

    - name: Step 6 - Create Authorizations
      include_role:
        name: wallix.bastion.authorizations
      when: wallix_authorizations is defined
      tags: [authorizations]

    - name: Display provisioning summary
      debug:
        msg:
          - "âœ… Provisioning complete!"
          - "Bastion: {{ wallix_bastion_host }}"
          - "Domains: {{ wallix_global_domains_created | default(0) }}"
          - "Users: {{ wallix_users_created | default(0) }}"
          - "Devices: {{ wallix_devices_created | default(0) }}"
          - "Authorizations: {{ wallix_authorizations_created | default(0) }}"
